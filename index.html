<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Jogo da Velha Infinito</title>
  <style>
    :root {
      --bg-color: #1a1a1a;
      --text-color: #ffffff;
      --accent: #00ff88;
      --cell-size: 80px;
    }
    
    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      touch-action: manipulation;
    }
    
    .container {
      text-align: center;
    }
    
    /* O board √© definido como position: relative para posicionar a linha de vit√≥ria */
    #board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 20px auto;
      position: relative;
      width: calc(3 * var(--cell-size) + 2 * 10px);
      height: calc(3 * var(--cell-size) + 2 * 10px);
    }
    
    .cell {
      width: var(--cell-size);
      height: var(--cell-size);
      background-color: #2d2d2d;
      border: 2px solid var(--accent);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 40px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .cell:hover {
      background-color: #3d3d3d;
    }
    
    .controls {
      margin: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    
    button {
      padding: 10px 20px;
      background-color: var(--accent);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: var(--bg-color);
      font-weight: bold;
    }
    
    #status {
      margin-top: 20px;
      font-size: 1.2em;
    }
    
    .fade-out {
      animation: fadeOut 0.5s forwards;
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    /* Linha de vit√≥ria (inicialmente oculta) */
    #winLine {
      position: absolute;
      background-color: var(--accent);
      display: none;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <button id="startReset">Come√ßar/Reiniciar</button>
      <button id="pause">Pausar</button>
    </div>
    <div id="board">
      <!-- Linha de vit√≥ria que ser√° exibida sobre o tabuleiro -->
      <div id="winLine"></div>
      <div class="cell" data-index="0"></div>
      <div class="cell" data-index="1"></div>
      <div class="cell" data-index="2"></div>
      <div class="cell" data-index="3"></div>
      <div class="cell" data-index="4"></div>
      <div class="cell" data-index="5"></div>
      <div class="cell" data-index="6"></div>
      <div class="cell" data-index="7"></div>
      <div class="cell" data-index="8"></div>
    </div>
    <div id="status"></div>
  </div>
  
  <script>
    let currentPlayer = 'X';
    let gameState = ['', '', '', '', '', '', '', '', ''];
    let gameActive = false;
    let isPaused = false;
    let moveHistory = { X: [], O: [] };
    let timeoutId = null;
    
    const winCombos = [
      [0, 1, 2], // horizontal superior
      [3, 4, 5], // horizontal central
      [6, 7, 8], // horizontal inferior
      [0, 3, 6], // vertical esquerda
      [1, 4, 7], // vertical central
      [2, 5, 8], // vertical direita
      [0, 4, 8], // diagonal principal
      [2, 4, 6]  // diagonal inversa
    ];
    
    // Eventos de clique
    document.querySelectorAll('.cell').forEach(cell => {
      cell.addEventListener('click', handleCellClick);
    });
    
    document.getElementById('startReset').addEventListener('click', startResetGame);
    document.getElementById('pause').addEventListener('click', togglePause);
    
    function handleCellClick(e) {
      if (!gameActive || isPaused) return;
      
      const index = e.target.dataset.index;
      
      if (gameState[index] === '') {
        // Registra a jogada e atualiza o hist√≥rico
        gameState[index] = currentPlayer;
        moveHistory[currentPlayer].push(index);
        e.target.textContent = currentPlayer;
        
        const winResult = checkWin();
        if (winResult) {
          showWinLine(winResult.combo);
          endGame(`Jogador ${winResult.winner} venceu!üèÜ`);
          return;
        }
        
        // Se o tabuleiro estiver cheio e sem vencedor, remove as pe√ßas mais antigas de ambos os jogadores
        if (isBoardFull()) {
          startRemoveOldestMoves();
        } else {
          currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
          updateStatus(`Vez do Jogador ${currentPlayer}`);
        }
      }
    }
    
    // Remove a pe√ßa mais antiga de cada jogador (libera 2 casas)
    function startRemoveOldestMoves() {
      if (timeoutId) return; // Evita m√∫ltiplos timers
      
      const removePair = () => {
        removeOldestMovesPair();
        
        const winResult = checkWin();
        if (winResult) {
          showWinLine(winResult.combo);
          endGame(`Jogador ${winResult.winner} venceu!üèÜ`);
          return;
        }
        
        if (isBoardFull()) {
          timeoutId = setTimeout(removePair, 2000);
        } else {
          updateStatus(`Vez do Jogador ${currentPlayer}`);
          timeoutId = null;
        }
      };
      
      timeoutId = setTimeout(removePair, 2000);
    }
    
    function removeOldestMovesPair() {
      let indexX, indexO;
      
      if (moveHistory.X.length > 0) {
        indexX = moveHistory.X.shift();
      }
      if (moveHistory.O.length > 0) {
        indexO = moveHistory.O.shift();
      }
      
      if (indexX !== undefined) {
        gameState[indexX] = '';
        updateCell(indexX);
      }
      if (indexO !== undefined) {
        gameState[indexO] = '';
        updateCell(indexO);
      }
    }
    
    function updateCell(index) {
      const cell = document.querySelector(`[data-index="${index}"]`);
      cell.classList.add('fade-out');
      setTimeout(() => {
        cell.textContent = '';
        cell.classList.remove('fade-out');
      }, 500);
    }
    
    // Verifica se h√° alguma combina√ß√£o vencedora
    function checkWin() {
      for (let combo of winCombos) {
        const [a, b, c] = combo;
        if (gameState[a] && gameState[a] === gameState[b] && gameState[a] === gameState[c]) {
          return { winner: gameState[a], combo };
        }
      }
      return null;
    }
    
    function isBoardFull() {
      return gameState.every(cell => cell !== '');
    }
    
    function startResetGame() {
      gameState = ['', '', '', '', '', '', '', '', ''];
      currentPlayer = 'X';
      gameActive = true;
      isPaused = false;
      moveHistory = { X: [], O: [] };
      clearTimeout(timeoutId);
      timeoutId = null;
      
      document.querySelectorAll('.cell').forEach(cell => {
        cell.textContent = '';
        cell.classList.remove('fade-out');
      });
      
      // Esconde a linha de vit√≥ria se estiver vis√≠vel
      const winLine = document.getElementById('winLine');
      if (winLine) {
        winLine.style.display = 'none';
      }
      
      updateStatus('Vez do Jogador X');
    }
    
    function togglePause() {
      isPaused = !isPaused;
      document.getElementById('pause').textContent = isPaused ? 'Continuar' : 'Pausar';
      updateStatus(isPaused ? 'Jogo Pausado' : `Vez do Jogador ${currentPlayer}`);
    }
    
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }
    
    function endGame(message) {
      gameActive = false;
      clearTimeout(timeoutId);
      timeoutId = null;
      updateStatus(message);
    }
    
    // Fun√ß√£o para exibir a linha de vit√≥ria com os ajustes para as diagonais
    function showWinLine(combo) {
      const winLine = document.getElementById('winLine');
      const cellSize = 80;
      const gap = 10;
      const boardWidth = 3 * cellSize + 2 * gap; // Ex: 260px
      const diagLength = Math.sqrt(Math.pow((boardWidth - cellSize), 2) * 2);
      
      // Vit√≥ria horizontal
      if (combo[0] + 1 === combo[1] && combo[1] + 1 === combo[2]) {
        let row = Math.floor(combo[0] / 3);
        let top = row * (cellSize + gap) + cellSize / 2 - 2.5;
        winLine.style.cssText = `top: ${top}px; left: 0; width: ${boardWidth}px; height: 5px; transform: none;`;
      }
      // Vit√≥ria vertical
      else if (combo[0] + 3 === combo[1] && combo[1] + 3 === combo[2]) {
        let col = combo[0] % 3;
        let left = col * (cellSize + gap) + cellSize / 2 - 2.5;
        winLine.style.cssText = `left: ${left}px; top: 0; width: 5px; height: ${boardWidth}px; transform: none;`;
      }
      // Diagonal principal [0, 4, 8] ‚Äì agora usando -45¬∞ para a dire√ß√£o correta
      else if (combo[0] === 0 && combo[1] === 4 && combo[2] === 8) {
        winLine.style.cssText = `
          top: 50%;
          left: 50%;
          width: 5px;
          height: ${diagLength}px;
          transform: translate(-50%, -50%) rotate(-45deg);
        `;
      }
      // Diagonal inversa [2, 4, 6] ‚Äì agora usando 45¬∞ para a dire√ß√£o correta
      else if (combo[0] === 2 && combo[1] === 4 && combo[2] === 6) {
        winLine.style.cssText = `
          top: 50%;
          left: 50%;
          width: 5px;
          height: ${diagLength}px;
          transform: translate(-50%, -50%) rotate(45deg);
        `;
      }
      winLine.style.display = 'block';
    }
  </script>
</body>
</html>
